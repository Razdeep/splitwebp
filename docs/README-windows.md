# Building & Installing from source in Windows platform
```
last updated: 2020-10-10
tested at: 2020-10-09
```

## Prerequisite

The steps are tested under this envionment. Please prepare these installed.

```
Windows 10 (64 bit)
Visual Studio Community 2017
Cmake 3.18.3
OpenCV 3.4.11
libwebp 1.1.0 windows-x64
```

- Download Visual Studio Community 2017, please visit [here](https://visualstudio.microsoft.com/vs/older-downloads/).
- Download Cmake 3.18.3, please visit [here](https://cmake.org/download/).
- Download OpenCV 3.4.11, please visit [here](https://opencv.org/releases/).
- Download libwebp 1.1.0, please visit [here](https://storage.googleapis.com/downloads.webmproject.org/releases/webp/index.html).


## Notes on install Cmake

In order to run Cmake in `CMD`, please make sure `PATH envionment variable` contains the folder of Cmake. eg: `C:\Program Files\CMake\bin`

One may check this by by running `echo %PATH%` in CMD.


## Notes on install OpenCV

The folder location of OpenCV is important. This program depends on this library.
The downloaded OpenCV file is usually an archive (self-extracting archive). Please extract to a certain folder. eg: `D:\opencv` (i.e. the `opencv extrated folder`)

Copy files listed below from folder `D:\opencv\build\x64\vc15\bin` to `System32 folder`. One may need Administrator right of the Windows system to do so.
```
opencv_ffmpeg3411_64.dll
opencv_world3411.dll
opencv_world3411.pdb
opencv_world3411d.dll
opencv_world3411d.pdb
```

**Alternatively**, one may add the path of OpenCV binary (eg: `D:\opencv\build\x64\vc15\bin`) to `PATH envionment variable`. You may refer to this [web page](https://www.deciphertechnic.com/install-opencv-with-visual-studio/).



## Notes on install libwebp

It locates within `Repo folder`, eg: `D:\splitwebp\3rdparty\libwebp\lib\windows-x64`

Please note that, in Windows, you need to rename the files if you download libwebp from [here](https://storage.googleapis.com/downloads.webmproject.org/releases/webp/index.html):
```
libwebp.lib -> webp.lib
libwebpdemux.lib -> webpdemux.lib
libwebpmux.lib -> webpmux.lib
```


## Steps to compile

1. Prepare the prerequisite

2. Clone this repository to `Repo folder`, eg: `D:\splitwebp`

3. Create a new folder named `build` under `Repo folder`, eg: `D:\splitwebp\build` (i.e. the `build folder`)

4. Open `CMD`, change the current directory to `build folder`

5. Run `cmake .. && cmake -DCMAKE_GENERATOR_PLATFORM=x64 --build .`

6. Visit Windows Explorer in `build folder`. Open the Visual Studio Project by double clicking `splitwebp.vcxproj`

7. Change Project properties (Solution Explorer > right click `splitwebp` > Properties)

    7.1. pointing Include folder of OpenCV

        In Properties, go to C/C++ > Additional Include Directories > click on the value and see a pull down menu > click Edit.. > click New Line. And add these paths:

        (if your `opencv extrated folder` is `D:\opencv`)

        D:\opencv\build\include
        D:\opencv\build\include\opencv
        D:\opencv\build\include\opencv2

    7.2. remove `/machine:x86` to build for x64 platform (64 bit). Delete `/machine:x86` in Additional Option, and click Apply.
        ![s](/docs/images/remove-x86.png)


8. Build solution. click Visual Studio's menu > Build > Build Solution (F7)

9. If no errors, the compiled exe file should be located at `Release` or `Debug` folder under the `build folder`, eg: `D:\splitwebp\build`


## Troubleshoot

1) > By not providing "FindOpenCV.cmake" in CMAKE_MODULE_PATH

    Solution: set the `envionment variable` named `OPENCV_DIR`. Open `CMD`, and run this command (This may require Administrator right. ):

    `setx -m OPENCV_DIR D:\opencv\build\x64\vc15\lib`

2) > Cannot find or open the PDB file

    is shown in the Output window of Visual Studio shows:

    Solution: Turn on `Microsoft Symbol Servers` for debugging symbol. Please refer to this [web page](https://docs.microsoft.com/en-us/visualstudio/debugger/specify-symbol-dot-pdb-and-source-files-in-the-visual-studio-debugger?view=vs-2019) for further details.


## Glossory
- `CMD` Command Prompt in Windows, accept user's command. Run it by: Start Menu => search "cmd" => click "Command Prompt" OR Start Menu > "Run" > type "cmd" > press Enter

- `Repo folder` The folder of this repository cloned into your local machine. eg: `D:\splitwebp`

- `build folder` The folder where the Visual Studio project generated by Cmake locates at. eg: `D:\splitwebp\build`

- `PATH envionment variable` This contains the paths that Windows system would try to find out the executive files to run when a user enter a command in CMD. One can view the content by running `echo %PATH%` in CMD.

- `System32 folder` An important folder for Windows to run. It contains system files and libraries binary. It usually locates at `C:\Windows\System32`

- `opencv extrated folder` eg: `D:/opencv`

- `OPENCV_DIR` This is the path where the library files locates at. It should be inside sub-folders in `opencv extrated folder`, eg: `D:/opencv/build/x64/vc15/lib`
